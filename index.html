<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Plate Finder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css" />
</head>
<body>

    <div class="app">
        <header class="header">
            <h1 class="logo">Plate<span>Picker</span></h1>
            <button class="settings-button" type="button">Settings</button>
        </header>
        <div class="weights-container">

        </div>
        <div class="input-container">
            <input type="number" class="weight-input" placeholder="Input Weight" />
            <select class="precent-input">
                <option value="1">100%</option>
                <option value="0.75">75%</option>
                <option value="0.5">50%</option>
                <option value="0.25">25%</option>
            </select>
        </div>

        <div class="settings-popup">
            <fieldset class="setting">
                <legend>Bar Weight</legend>
                <input type="number" class="bar-weight" />
            </fieldset>

            <fieldset class="setting">
                <legend>Weight Sets</legend>

                <label>55</label>
                <select class="weight-select weight-55">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>

                <label>45</label>
                <select class="weight-select weight-45">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>

                <label>35</label>
                <select class="weight-select weight-35">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>

                <label>25</label>
                <select class="weight-select weight-25">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>

                <label>10</label>
                <select class="weight-select weight-10">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>

                <label>5</label>
                <select class="weight-select weight-5">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>

                <label>2.5</label>
                <select class="weight-select weight-2point5">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>

                <label>1.25</label>
                <select class="weight-select weight-1point25">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </fieldset>
        </div>
    </div>

<script>

// calculates and displays the plates needed for a given weight
function findWeights() {
    let weight = document.querySelector('.weight-input').value,
        precent = document.querySelector('.precent-input').value,
        bar_weight = window.localStorage.barWeight || 45,
        net_weight = ( ( weight - bar_weight ) * precent ) / 2,
        plates = [],
        output = '';

    while (net_weight > 0) {
        if (net_weight >= 45) {
            net_weight -= 45;
            plates.push('<div class="plate size-45">45</div>');
        } else if (net_weight >= 35) {
            net_weight -= 35;
            plates.push('<div class="plate size-35">35</div>');
        } else if (net_weight >= 25) {
            net_weight -= 25;
            plates.push('<div class="plate size-25">25</div>');
        } else if (net_weight >= 10) {
            net_weight -= 10;
            plates.push('<div class="plate size-10">10</div>');
        } else if (net_weight >= 5) {
            net_weight -= 5;
            plates.push('<div class="plate size-5">5</div>');
        } else if (net_weight >= 2.5) {
            net_weight -= 2.5;
            plates.push('<div class="plate size-2point5">2.5</div>');
        } else if (net_weight >= 1.25) {
            net_weight -= 1.25;
            plates.push('<div class="plate size-1point25">1.25</div>');
        } else {
            plates.push('<div class="plate size-LO">' + net_weight + '</div>');
            net_weight = 0;
        }
    }

    if ( plates.length > 0 ) {
        let last = '';
        for ( let a = 0; a < plates.length; a += 1 ) {
            if ( plates[ a ] != last ) {
                if ( a != 0 ) {
                    output += '</div>';
                }
                output += '<div class="group">' + plates[ a ];
            } else {
                output += plates[ a ];
            }
            last = plates[ a ];
        }
        output += '</div>';
        document.querySelector('.weights-container').innerHTML = output;
    } else {
        document.querySelector('.weights-container').innerHTML = '';
    }

    if ( weight.length == 3 ) {
        document.querySelector('.weight-input').blur();
    }
}
document.querySelector('.weight-input').addEventListener( 'keyup', findWeights);
document.querySelector('.precent-input').addEventListener( 'change', findWeights);

// opens settings menu
document.querySelector('.settings-button').addEventListener( 'click', ()=>{
    document.querySelector('.settings-popup').classList.toggle('open');
});

// sets the bar weight value in settings
function setBarWeight() {
    let bar_weight = document.querySelector('.bar-weight').value;
     window.localStorage.barWeight = bar_weight;
}
document.querySelector('.bar-weight').addEventListener( 'keyup', setBarWeight);

// retrieves and sets default values in settings
function init() {
    // set default bar weight value
    window.localStorage.barWeight = window.localStorage.barWeight || 45;

    // display bar weight in settings
    document.querySelector('.bar-weight').value = window.localStorage.barWeight;

    // calculate weights in case field is auto filled by browser on page load
    findWeights();
}

init();

</script>
</body>
</html>
